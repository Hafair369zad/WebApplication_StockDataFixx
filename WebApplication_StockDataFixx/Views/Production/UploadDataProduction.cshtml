@{
    ViewData["Title"] = "Production";
    Layout = "~/Views/Shared/_LayoutProduction.cshtml";
    var CurrentUsername = Context.Session.GetString("CurrentUsername");
}

<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
</head>
<body>

    <div class="container-fluid p-0">
        <div class="row" style="margin-top: -70px;">
            <div class="col-md-12 mb-10">
                <div class="card flex-fill w-100 mb-10" style="border-radius: 10px;background: #FFF;">
                    <div class="card-dash">
                        <div class="card-body py-3">
                            <div class="chart chart-sm">
                                <!-- <canvas id="chartjs-dashboard-line"></canvas> -->
                                <img src="~/images/img/Frame_3_1.png"
                                     style="width: 320px;margin-left: 260px; position: absolute; right: -1px">
                                @using Microsoft.AspNetCore.Http;
                                <h4 class="text-dash"><strong>Halo @CurrentUsername !! </strong></h4>
                                <p style="color: #001C30; font-weight: 500; font-size: 20px; margin-top: 60px;">
                                    Enhance Production Management with<br>Real-Time <strong style="font-weight: 800;">Stock Data Insights</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br />

    <div class="container-fluid p-0">
        <div class="card flex-fill w-100 h-100 mb-10">
            <div class="card-cr">
                <div class="upload-form">
                    <form id="myForm" asp-controller="Production" asp-action="UploadFile" enctype="multipart/form-data" method="post">
                        <div class="header-upload">
                            <p>UPLOAD FILE .XLS</p>
                        </div>
                        <button type="submit" class="btn-upload">Upload</button>
                        <div class="row">
                            <div class="col-12 col-md-8">
                                <div class="form-group">
                                    <!-- Hidden input file element -->
                                    <input type="file" class="form-control-file" id="file" accept=".xls, .xlsx, .csv" style="display: none;" name="file">
                                    <div class="drop-zone" id="dropZone">
                                        <div class="image-container">
                                            <img src="/images/img/Frame_4.png" style="margin-left: 3px; margin-bottom: 5px;">
                                            <p class="drag-text" style="margin-left: -10px;">Drag and drop file here</p>
                                        </div>
                                    </div>
                                    <div class="btn-zone w-100 col-12">
                                        <!-- Apply button -->
                                        <label for="file" class="btn col-3">Pilih</label>
                                        <button class="btn col-3" id="resetBtn" type="button" value="Reset">Hapus</button>
                                    </div>
                                </div>
                            </div>
                            @*style="margin-left: -140px; margin-top: 80px;"*@
                            <div class="col-12 col-md-4 mt-4 mt-md-0" >
                                <div class="row">
                                    <div class="col-12">
                                        <div class="li-file mt-4">
                                            <h5>Ketentuan File :</h5><br />
                                            <p>
                                                <ul>
                                                    <ol>
                                                        <li>File upload harus dalam format <strong>.XLS, .XLSX, .CSV (Microsoft Excel).</strong></li>
                                                        <li>Pastikan mengunggah File <strong>Data Production</strong>.</li>
                                                        <li>File harus mengandung beberapa tabel yang terpisah secara jelas.</li>
                                                        <li>Pastikan setiap tabel memiliki judul yang jelas dan informatif.</li>
                                                        <li>Pastikan tidak ada data yang tersembunyi atau terlindungi dengan kata sandi.</li>
                                                    </ol>
                                                </ul>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script>
            const fileInput = document.getElementById('file');
            const resetBtn = document.getElementById('resetBtn');
            const dropZone = document.getElementById('dropZone');

            fileInput.addEventListener('change', function () {
                const fileLabel = document.createElement('p');
                fileLabel.textContent = `File name: ${fileInput.files[0].name}`;
                fileLabel.style.marginTop = '10px';
                fileLabel.classList.add('file-label'); // Add a class to the file label for easy identification

                // Check if there's already a file label and remove it before adding the new one
                const existingFileLabel = document.querySelector('.file-label');
                if (existingFileLabel) {
                    existingFileLabel.remove();
                }

                document.querySelector('.form-group').appendChild(fileLabel);
            });

            resetBtn.addEventListener('click', function () {
                fileInput.value = ''; // Clear the selected file
                const existingFileLabel = document.querySelector('.file-label');
                if (existingFileLabel) {
                    existingFileLabel.remove();
                }
            });

            // Function to handle files dropped into the drop-zone
            function handleFileDrop(event) {
                event.preventDefault();
                const files = event.dataTransfer.files;
                fileInput.files = files;

                const fileLabel = document.createElement('p');
                fileLabel.textContent = `File name: ${files[0].name}`;
                fileLabel.style.marginTop = '10px';
                fileLabel.classList.add('file-label'); // Add a class to the file label for easy identification

                // Check if there's already a file label and remove it before adding the new one
                const existingFileLabel = document.querySelector('.file-label');
                if (existingFileLabel) {
                    existingFileLabel.remove();
                }

                document.querySelector('.form-group').appendChild(fileLabel);
            }

            // Event listener for the drop-zone to handle the drop event
            dropZone.addEventListener('drop', handleFileDrop);

            // Event listener for the drop-zone to handle the dragover event
            dropZone.addEventListener('dragover', function (event) {
                event.preventDefault();
            });
        </script>
    </div>

    <!--Pop Up-->
    <div class="popup" id="popup">
        <div class="popup-content">
            <h2>File Uploaded!</h2>
            <img src="~/images/img/Frame_5_1.png" width="140px" />
            <p>Your file has been successfully uploaded and data has been saved to the database.</p>
            <button class="close-button" onclick="closePopup()">Close</button>
        </div>
    </div>

    <script>
        function closePopup() {
            document.getElementById("popup").style.display = "none";
        }

        // Fungsi untuk menampilkan popup
        function showPopup() {
            document.getElementById("popup").style.display = "block";
        }

        // Fungsi untuk mengirim form dan menampilkan popup setelah berhasil
        function submitFormAndShowPopup() {
            document.getElementById("myForm").submit(); // Kirim form
            checkDataSaved(); // Panggil fungsi untuk cek data sudah disimpan dan tampilkan popup jika ya
        }

        // Fungsi untuk cek data sudah disimpan dan tampilkan popup jika berhasil
        function checkDataSaved() {
            // Ganti dengan AJAX request ke server untuk melakukan pengecekan data
            fetch("/Production/CheckDataSaved") // Ganti URL endpoint sesuai dengan controller dan action yang sesuai
                .then(response => response.json())
                .then(data => {
                    if (data.saved) {
                        // Data berhasil disimpan, tampilkan popup
                        showPopup();
                    } else {
                        // Data belum berhasil disimpan, coba cek lagi setelah beberapa waktu (misalnya 1 detik)
                        setTimeout(checkDataSaved, 1000);
                    }
                })
                .catch(error => {
                    console.error('Error checking data saved:', error);
                });
        }

        // Tambahkan event listener untuk form submit
        document.getElementById("myForm").addEventListener("submit", function (event) {
            event.preventDefault(); // Hentikan submit default
            submitFormAndShowPopup(); // Panggil fungsi untuk submit form dan tampilkan popup
        });
    </script>


</body>
</html>






 



